<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hydraulic Functions Â· ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../../assets/documenter.js"></script><script src="../../../../../siteinfo.js"></script><script src="../../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../../"><img src="../../../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../../../GettingStarted/Terminology/">Terminology</a></li><li><a class="tocitem" href="../../../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../TutorialList/">Home</a></li><li><a class="tocitem" href="../../../../how_to_make_a_balance_law/">Balance Law</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Atmos/heldsuarez/">Dry Idealized GCM (Held-Suarez)</a></li><li><a class="tocitem" href="../../../../Atmos/burgers_single_stack/">Single Element Stack Experiment (Burgers Equation)</a></li><li><a class="tocitem" href="../../../../Atmos/densitycurrent/">LES Experiment (Density Current)</a></li><li><a class="tocitem" href="../../../../Atmos/risingbubble/">LES Experiment (Rising Thermal Bubble)</a></li><li><a class="tocitem" href="../../../../Atmos/agnesi_hs_lin/">Linear Hydrostatic Mountain (Topography)</a></li><li><a class="tocitem" href="../../../../Atmos/agnesi_nh_lin/">Linear Non-Hydrostatic Mountain (Topography)</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-4-1" type="checkbox"/><label class="tocitem" for="menuitem-3-4-1"><span class="docs-label">Heat</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Heat/heat_equation/">Heat Equation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4-2"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Hydraulic Functions</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Preliminary-setup"><span>Preliminary setup</span></a></li><li class="toplevel"><a class="tocitem" href="#Specifying-a-hydraulics-model"><span>Specifying a  <code>hydraulics</code> model</span></a></li><li class="toplevel"><a class="tocitem" href="#Matric-Potential"><span>Matric Potential</span></a></li><li class="toplevel"><a class="tocitem" href="#Hydraulic-conductivity"><span>Hydraulic conductivity</span></a></li><li class="toplevel"><a class="tocitem" href="#Other-features"><span>Other features</span></a></li><li class="toplevel"><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../../Heat/bonan_heat_tutorial/">Soil Heat Equation</a></li><li><a class="tocitem" href="../equilibrium_test/">Richards Equation</a></li><li><a class="tocitem" href="../../Coupled/equilibrium_test/">Coupled Water and Heat</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Ocean</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Ocean/geostrophic_adjustment/">One-dimensional geostrophic adjustment</a></li><li><a class="tocitem" href="../../../../Ocean/internal_wave/">Propagating mode-1 internal wave</a></li><li><a class="tocitem" href="../../../../Ocean/shear_instability/">Shear instability</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-6-1" type="checkbox"/><label class="tocitem" for="menuitem-3-6-1"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/SystemSolvers/cg/">Conjugate Gradient</a></li><li><a class="tocitem" href="../../../../Numerics/SystemSolvers/bgmres/">Batched Generalized Minimal Residual</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6-2" type="checkbox"/><label class="tocitem" for="menuitem-3-6-2"><span class="docs-label">DG Methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Numerics/DGMethods/showcase_filters/">Filters</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-7" type="checkbox"/><label class="tocitem" for="menuitem-3-7"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-7-1" type="checkbox"/><label class="tocitem" for="menuitem-3-7-1"><span class="docs-label">Debug</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Diagnostics/Debug/StateCheck/">State Statistics Regression</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../../../HowToGuides/Common/UniversalFunctions/">Universal Functions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/TemperatureProfiles/">Temperature profiles</a></li><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/AtmosReferenceState/">Reference profiles</a></li><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/MoistureModelChoices/">Moisture model</a></li><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/PrecipitationModelChoices/">Precipitation model</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox"/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/DGMethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Diagnostics/UsingDiagnostics/">Using Diagnostics</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Driver</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Driver/">Top level interface</a></li><li><a class="tocitem" href="../../../../../APIs/Driver/Checkpoint/">Checkpoint</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../../APIs/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../../../APIs/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../../APIs/Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><a class="tocitem" href="../../../../../APIs/Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../../../APIs/Land/Runoff/">Runoff Parameterizations</a></li><li><a class="tocitem" href="../../../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../../../../APIs/Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../../../APIs/Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../../../APIs/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../../../APIs/BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../Theory/Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../../../../Theory/Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../Theory/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/EDMF_plots/">EDMF Model</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Microphysics_0M/">Microphysics_0M</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../../../DevDocs/ModelVariableList/">Model variable list</a></li><li><a class="tocitem" href="../../../../../DevDocs/ModelOutput/">Model output</a></li><li><a class="tocitem" href="../../../../../DevDocs/DiagnosticVariableList/">Diagnostic variable list</a></li><li><a class="tocitem" href="../../../../../DevDocs/SystemImage/">Custom System Image</a></li></ul></li><li><a class="tocitem" href="../../../../../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Land</a></li><li><a class="is-disabled">Soil</a></li><li class="is-active"><a href>Hydraulic Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hydraulic Functions</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Hydraulic-functions"><a class="docs-heading-anchor" href="#Hydraulic-functions">Hydraulic functions</a><a id="Hydraulic-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Hydraulic-functions" title="Permalink"></a></h1><p>This tutorial shows how to specify the hydraulic functions used in Richard&#39;s equation. In particular, we show how to choose the formalism for matric potential and hydraulic conductivity, and how to make the hydraulic conductivity account for the presence of ice as well as the temperature dependence of the viscosity of liquid water.</p><p>ClimateMachine&#39;s Land model allows the user to pick between two hydraulics models, that of van Genuchten [1] or that of Brooks and Corey [2, 3]. The same model is consistently used for the matric potential and hydraulic conductivity.</p><h1 id="Preliminary-setup"><a class="docs-heading-anchor" href="#Preliminary-setup">Preliminary setup</a><a id="Preliminary-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Preliminary-setup" title="Permalink"></a></h1><p>External modules</p><pre><code class="language-julia">using Plots</code></pre><p>ClimateMachine modules</p><pre><code class="language-julia">using ClimateMachine
using ClimateMachine.Land
using ClimateMachine.Land.SoilWaterParameterizations

const FT = Float32;</code></pre><h1 id="Specifying-a-hydraulics-model"><a class="docs-heading-anchor" href="#Specifying-a-hydraulics-model">Specifying a  <code>hydraulics</code> model</a><a id="Specifying-a-hydraulics-model-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-a-hydraulics-model" title="Permalink"></a></h1><p>The van Genuchten model requires two free parameters, <code>Î±</code> and <code>n</code>. A third parameter, <code>m</code>, is computed from <code>n</code>. Of these, only <code>Î±</code> carries units, of inverse meters. The Brooks and Corey model also uses two free parameters, <code>Ï_b</code>, the magnitude of the matric potential at saturation,  and a constant <code>M</code>. <code>Ï_b</code> carries units of meters. The hydraulic conductivity requires an additional parameter, <code>Ksat</code> (m/s), which is the hydraulic conductivity in saturated soil. This parameter is the same between the two models for a given soil type, and is not stored in the <code>hydraulics</code> model, but rather as part of the <a href="../../../../../APIs/Land/LandModel/#ClimateMachine.Land.SoilParamFunctions"><code>SoilParamFunctions</code></a>.</p><p>Below we show how to create two concrete examples of these hydraulics models, for sandy loam [1]. Note that the parameters chosen are a function of soil type.</p><pre><code class="language-julia">vg_Î± = FT(7.5) # m^-1
vg_n = FT(1.89)
hydraulics = vanGenuchten{FT}(Î± = vg_Î±, n = vg_n)

Ï_sat = 0.09 # m
Mval = 0.228
hydraulics_bc = BrooksCorey{FT}(Ïb = Ï_sat, m = Mval);</code></pre><h1 id="Matric-Potential"><a class="docs-heading-anchor" href="#Matric-Potential">Matric Potential</a><a id="Matric-Potential-1"></a><a class="docs-heading-anchor-permalink" href="#Matric-Potential" title="Permalink"></a></h1><p>The matric potential <code>Ï</code> represents how much water clings to soil. Drier soil holds onto water more tightly, making diffusion more difficult. As soil becomes wetter, the matric potential decreases in magnitude, making diffusion easier.</p><p>The van Genuchten expression for matric potential is <span>$Ï = -\frac{1}{Î±} S_l^{-1/(nm)}\times (1-S_l^{1/m})^{1/n},$</span></p><p>and the Brooks and Corey expression is <span>$Ï = -Ï_b S_l^{-M}.$</span></p><p>Here <code>S_l</code> is the effective saturation of liquid water, <code>Î¸_l/Î½</code>, where <code>Î½</code> is porosity of the soil. We neglect the residual pore space in the CliMA model.</p><p>In the CliMA code, we use <a href="https://en.wikipedia.org/wiki/Multiple_dispatch">multiple dispatch</a>. With multiple dispatch, a function can have many ways of executing (called methods), depending on the <em>type</em> of the variables passed in. A simple example of multiple dispatch is the division operation. Integer division takes two numbers as input, and returns an integer - ignoring the decimal. Float division takes two numbers as input, and returns a floating point number, including the decimal. In Julia, we might write these as:</p><pre><code class="language-julia">function division(a::Int, b::Int)
     return floor(Int, a/b)
end</code></pre><pre><code class="language-julia">function division(a::Float64, b::Float64)
     return a/b
end</code></pre><p>We can see that <code>division</code> is now a function with two methods.</p><pre><code class="language-julia">julia&gt; division
division (generic function with 2 methods)</code></pre><p>Now, using the same function signature, we can carry out integer division or floating point division, depending on the types of the arguments:</p><pre><code class="language-julia">julia&gt; division(1,2)
0

julia&gt; division(1.0,2.0)
0.5</code></pre><p>Here is a more pertinent example: <code>hydraulics</code> is of type <code>vanGenuchten{Float32}</code> based on our choice of <code>FT</code>:</p><pre><code class="language-julia">julia&gt; typeof(hydraulics)
vanGenuchten{Float32}</code></pre><p>but meanwhile,</p><pre><code class="language-julia">julia&gt; typeof(hydraulics_bc)
BrooksCorey{Float32}</code></pre><p>The function <code>matric_potential</code> will execute different methods depending on if we pass a hydraulics model of type <code>vanGenuchten</code> or <code>BrooksCorey</code>. In both cases, it will return the correct value for <code>Ï</code>.</p><p>Let&#39;s plot the matric potential as a function of the effective saturation <code>S_l = Î¸_l/Î½</code>, which can range from zero to one.</p><pre><code class="language-julia">S_l = FT.(0.01:0.01:0.99)
Ï = matric_potential.(Ref(hydraulics), S_l)
Ï_bc = matric_potential.(Ref(hydraulics_bc), S_l)
plot(
    S_l,
    log10.(-Ï),
    xlabel = &quot;effective saturation&quot;,
    ylabel = &quot;Log10(|Ï|)&quot;,
    label = &quot;van Genuchten&quot;,
)
plot!(S_l, log10.(-Ï_bc), label = &quot;Brooks and Corey&quot;)
savefig(&quot;bc_vg_matric_potential.png&quot;)</code></pre><p><img src="../bc_vg_matric_potential.png" alt/></p><p>The steep slope in <code>Ï</code> near saturated and completely dry soil are part of the reason why Richard&#39;s equation is such a challenging numerical problem.</p><h1 id="Hydraulic-conductivity"><a class="docs-heading-anchor" href="#Hydraulic-conductivity">Hydraulic conductivity</a><a id="Hydraulic-conductivity-1"></a><a class="docs-heading-anchor-permalink" href="#Hydraulic-conductivity" title="Permalink"></a></h1><p>The hydraulic conductivity is a more complex function than the matric potential, as it depends on the temperature of the water, the volumetric ice fraction, and the volumetric liquid water fraction. It also depends on the <code>hydraulics</code> model chosen.</p><p>We represent the hydraulic conductivity <code>K</code> as the product of four factors: <code>Ksat</code>, an <code>impedance_factor</code> (which accounts for the effect of ice on conductivity) a <code>viscosity_factor</code> (which accounts for the effect of temperature on the viscosity of liquid water, and how that in turn affects conductivity) and a <code>moisture_factor</code> (which accounts for the effect of liquid water, and is determined by the <code>hydraulics</code> model).</p><p>Let&#39;s start with ice and temperature independence, but moisture dependence. Below we choose additional parameters, consistent with the <code>hydraulics</code> parameters for sandy loam [1].</p><pre><code class="language-julia">Î½ = FT(0.41)
Ksat = FT(4.42 / (3600 * 100))
moisture_choice = MoistureDependent{FT}()
viscosity_choice = ConstantViscosity{FT}()
impedance_choice = NoImpedance{FT}();</code></pre><p>We are going to calculate <code>K = Ksat Ã viscosity_factor Ã impedance_factor Ã moisture_factor</code>. In the code, each of these factors is a function with multiple methods, except for <code>Ksat</code>.  Our function <code>hydraulic_conductivity</code> calls each of these functions in turn, and these functions use multiple dispatch to provide the correct value for <code>K</code>.</p><p>Like we defined new type classes for <code>vanGenuchten{FT}</code> and <code>BrooksCorey{FT}</code>, we also created new type classes for the impedance choice, the viscosity choice, and the moisture choice.  For example, the function called <code>viscosity_factor</code>, when passed an object of type <code>ConstantViscosity{FT}</code>, executes a method that always returns 1. The same is true for the function <code>impedance_factor</code>, using the type <code>NoImpedance{FT}</code>, and for <code>moisture_factor</code>, using the type <code>MoistureIndependent{FT}</code>.</p><p>In the case where the <code>moisture_factor = MoistureDependent{FT}()</code>, either the van Genuchten or Brooks and Corey expression is used based on the type of <code>hydraulics</code> model passed.</p><p>The <code>moisture_factor</code> for the van Genuchten model is (denoting it as <span>$K_m$</span>)</p><p><span>$K_m = \sqrt{S_l}[1-(1-S_l^{1/m})^m]^2,$</span></p><p>for <span>$S_l &lt; 1$</span>,</p><p>and for the Brooks and Corey model it is</p><p><span>$K_m = S_l^{2M+3},$</span></p><p>also for <span>$S_l&lt;1$</span>. When <span>$S_l\geq 1$</span>, <span>$K_m = 1$</span> for each model.</p><p>One side effect of this flexibility is that <code>hydraulic_conductivity</code> requires all the arguments it could possibly need passed to it, which is why here we must supply a value <code>T</code> and <code>Î¸_i</code>, even though they are not used in this particular example.</p><pre><code class="language-julia">T = FT(0.0)
Î¸_i = FT(0.0)

K =
    Ksat .*
    hydraulic_conductivity.(
        Ref(impedance_choice),
        Ref(viscosity_choice),
        Ref(moisture_choice),
        Ref(hydraulics),
        Ref(Î¸_i),
        Ref(Î½),
        Ref(T),
        S_l,
    );</code></pre><p>Let&#39;s also compute <code>K</code> when we include the effects of temperature and ice on the hydraulic conductivity. In the cases where a <code>TemperatureDependentViscosity{FT}</code> or <code>IceImpedance{FT}</code> type is passed, the correct factors are calculated, based on the temperature <code>T</code> and volumetric ice fraction <code>Î¸_i</code>. In these cases, the <code>viscosity_factor</code>, denoted here as <span>$K_v$</span>, evaluates as:</p><p><span>$K_v = e^{\gamma(T-T_{ref})},$</span></p><p>where <span>$\gamma = 0.0264 \mbox{K}^{-1}$</span> is an empirical factor, and <span>$T_{ref} = 288$</span> K, and the <code>impedance_factor</code>, denoted <span>$K_i$</span>, evaluates as:</p><p><span>$K_i = 10^{-\Omega f_i}$</span></p><p>where <span>$\Omega = 7$</span> is an empirical factor and <span>$f_i$</span> is the ratio of the volumetric ice fraction to total volumetric water fraction [5].</p><pre><code class="language-julia">viscosity_choice_T = TemperatureDependentViscosity{FT}()
T = FT(300.0)
K_T =
    Ksat .*
    hydraulic_conductivity.(
        Ref(impedance_choice),
        Ref(viscosity_choice_T),
        Ref(moisture_choice),
        Ref(hydraulics),
        Ref(Î¸_i),
        Ref(Î½),
        Ref(T),
        S_l,
    )
ice_impedance_I = IceImpedance{FT}()
Î¸_i = FT(0.1)
S_i = Î¸_i / Î½;</code></pre><p>The total volumetric water fraction cannot exceed unity, so the effective liquid water saturation should have a max of 1-S_i.</p><pre><code class="language-julia">S_l_accounting_for_ice = FT.(0.01:0.01:(0.99 - S_i))
K_i =
    Ksat .*
    hydraulic_conductivity.(
        Ref(ice_impedance_I),
        Ref(viscosity_choice),
        Ref(moisture_choice),
        Ref(hydraulics),
        Ref(Î¸_i),
        Ref(Î½),
        Ref(T),
        S_l_accounting_for_ice,
    )
plot(
    S_l,
    log10.(K),
    xlabel = &quot;total effective saturation, (Î¸_i+Î¸_l)/Î½&quot;,
    ylabel = &quot;Log10(K)&quot;,
    label = &quot;Base case&quot;,
    legend = :bottomright,
)
plot!(S_l, log10.(K_T), label = &quot;Temperature Dependent Viscosity; no ice&quot;)
plot!(
    S_l_accounting_for_ice .+ S_i,
    log10.(K_i),
    label = &quot;Ice Impedance; S_i=0.24&quot;,
)
savefig(&quot;T_ice_K.png&quot;)</code></pre><p><img src="../T_ice_K.png" alt/></p><p>If the user is not considering phase transitions and does not add in Freeze/Thaw source terms, the default is for zero ice in the model, for all time and space. In this case the ice impedance factor evaluates to 1 regardless of which type is passed.</p><p>We can also look and see how the Brooks and Corey moisture factor differs from the van Genuchten moisture factor by changing the <code>hydraulics</code> model passed:</p><pre><code class="language-julia">T = FT(0.0)
Î¸_i = FT(0.0)

K_bc =
    Ksat .*
    hydraulic_conductivity.(
        Ref(impedance_choice),
        Ref(viscosity_choice),
        Ref(moisture_choice),
        Ref(hydraulics_bc),
        Ref(Î¸_i),
        Ref(Î½),
        Ref(T),
        S_l,
    )
plot(
    S_l,
    log10.(K),
    xlabel = &quot;effective saturation&quot;,
    ylabel = &quot;Log10(K)&quot;,
    label = &quot;van Genuchten&quot;,
)
plot!(
    S_l,
    log10.(K_bc),
    xlabel = &quot;effective saturation&quot;,
    ylabel = &quot;Log10(K)&quot;,
    label = &quot;Brooks and Corey&quot;,
)
savefig(&quot;bc_vg_k.png&quot;)</code></pre><p><img src="../bc_vg_k.png" alt/></p><h1 id="Other-features"><a class="docs-heading-anchor" href="#Other-features">Other features</a><a id="Other-features-1"></a><a class="docs-heading-anchor-permalink" href="#Other-features" title="Permalink"></a></h1><p>The user also has the choice of making the conductivity constant by choosing <code>MoistureIndependent{FT}()</code> along with <code>ConstantViscosity{FT}()</code> and <code>NoImpedance{FT}()</code> . This is useful for debugging!</p><pre><code class="language-julia">no_moisture_dependence = MoistureIndependent{FT}()
K_constant =
    Ksat .*
    hydraulic_conductivity.(
        Ref(impedance_choice),
        Ref(viscosity_choice),
        Ref(no_moisture_dependence),
        Ref(hydraulics),
        Ref(Î¸_i),
        Ref(Î½),
        Ref(T),
        S_l,
    );</code></pre><pre><code class="language-julia">julia&gt; unique(K_constant)
1-element Array{Float32,1}:
 1.2277777f-5</code></pre><p>Note that choosing this option does not mean the matric potential is constant, as a hydraulics model is still required and employed.</p><p>And, lastly, you might be wondering why we left <code>Ksat</code> out of the function for <code>hydraulic_conductivity</code>. It turns out it is also useful for debugging to be able to turn off the diffusion of water, by setting <code>Ksat = 0</code>.</p><h1 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h1><p>[1] van Genuchten, M. T. (1980), A closed-form equation for predicting the hydraulic conductivity of unsaturated soils, Soil Sci. Soc. Amer. J., pp. 892â898.</p><p>[2] Brooks, R. J., and A. T. Corey (1964), Hydraulic properties of porous media.</p><p>[3] Corey, A. T. (1977), Mechanics of Heterogeneous Fluids in Porous Media, Water Resources Publication, Fort Collins, CO.</p><p>[4] Bonan, G. (2019), Climate Change and Terrestrial Ecoystem Modeling, Cambridge Univ. Press, Cambridge, UK, and New York, NY, USA. Chapter 8, Page 120</p><p>[5] Lundin, L.-C. (1990), Hydraulic properties in an operational model of frozen soil, J. Hydrol., 118, 289â310.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Heat/heat_equation/">Â« Heat Equation</a><a class="docs-footer-nextpage" href="../../Heat/bonan_heat_tutorial/">Soil Heat Equation Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 17 December 2020 09:22">Thursday 17 December 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
